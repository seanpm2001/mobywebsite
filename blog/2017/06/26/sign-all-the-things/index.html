<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sign all the things!</title>
    <link rel="alternate" type="application/atom+xml" title="Blog" href="https://blog.mobyproject.org/feed" />
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <link href="/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800" rel="stylesheet">
    <link rel="stylesheet" href="/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
  </head>


<nav class="primary-nav-filled navbar navbar-toggleable-md fixed-top navbar-inverse navbar-expand-md">
    <!-- <div class="container"> -->
        <button class="toggle navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fa fa-bars" aria-hidden="true"></i>
            <!-- <i class="fa fa-caret-down" aria-hidden="true"></i> -->
        </button>
        <div class="brand">
            <a href="/">
  <svg id="62fd0a44-006e-4f0b-a15a-89faa84d6829" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 167.2 34.89"><title>moby</title><g id="b15aae01-8804-4f98-8c25-fdaeefa1406f" data-name="Page-1"><g id="3e77fe43-c191-4609-bd1f-fc92b641d8de" data-name="Artboard"><g id="db658e32-7de5-4695-8ac0-c1dafbc7f969" data-name="Group"><g id="1a13e8e5-cf70-4a93-aa29-e6bc1921be6a" data-name="Rectangle"><path d="M5.32,20.44A16.12,16.12,0,1,0,21.44,4.32,16.12,16.12,0,0,0,5.32,20.44ZM4,20.44A17.44,17.44,0,1,1,21.44,37.89,17.44,17.44,0,0,1,4,20.44Z" transform="translate(-4 -3)" style="fill:#fff"/></g><g id="5afc6b6f-2ffa-4176-9b5f-ab9c171c04c9" data-name="Combined-Shape"><path d="M18,36.68a52.79,52.79,0,0,0,3.1-6.28c3.13.09,9.9,0,13.29-6.56.09-.17.26-.52.87-1.81l.35-.69L33.69,20.2C31.6,18.82,26.74,18.3,23,19c-.43-3.54-2.43-6.56-6-9.33L15,8.28l-1.39,2.07a16.05,16.05,0,0,0-2.34,9.76,11.45,11.45,0,0,0,1.82,5.35A14.35,14.35,0,0,1,6.21,27,16.57,16.57,0,1,1,18,36.68Zm-4.07-1.44q-.73-.39-1.38-.79Q13.22,34.88,13.93,35.24Z" transform="translate(-4 -3)" style="fill:#fff"/></g></g><g id="0e76a8cc-554a-48a7-8f33-c1ca2fcc7436" data-name="Moby" style="isolation:isolate"><g style="isolation:isolate"><path d="M60.56,26.86l-3.08-8V28H54.2V14h4.44l3.48,8.86L65.62,14h4.44V28H66.78V18.82l-3.08,8Z" transform="translate(-4 -3)" style="fill:#fff"/><path d="M77.38,17.24a5.43,5.43,0,0,1,5.76,5.5,5.49,5.49,0,0,1-5.76,5.52,5.4,5.4,0,0,1-5.7-5.48A5.49,5.49,0,0,1,77.38,17.24Zm0,8.08a2.43,2.43,0,0,0,2.42-2.58,2.4,2.4,0,1,0-4.78,0A2.35,2.35,0,0,0,77.38,25.32Z" transform="translate(-4 -3)" style="fill:#fff"/><path d="M87.64,28H84.52V13.54h3.34V18.3a3.88,3.88,0,0,1,2.8-1.06c3,0,5,2.26,5,5.52s-2.12,5.5-5.14,5.5a4,4,0,0,1-2.84-1.08ZM90,25.34a2.29,2.29,0,0,0,2.26-2.56A2.32,2.32,0,0,0,90,20.18c-1.32,0-2.26.94-2.26,2.6A2.31,2.31,0,0,0,90,25.34Z" transform="translate(-4 -3)" style="fill:#fff"/><path d="M101.84,31.58H98.68l1.42-3.92L96.18,17.5h3.58l1.86,6,1.94-6H107Z" transform="translate(-4 -3)" style="fill:#fff"/></g></g><g id="cd464abf-e261-4a16-a9b5-77df6384f4d3" data-name="project" style="isolation:isolate"><g style="isolation:isolate"><path d="M111.5,17.62h1v1.92a4.41,4.41,0,0,1,3.86-2.18c3,0,5.06,2.26,5.06,5.42s-2,5.48-5,5.48a4.52,4.52,0,0,1-4-2.24v5.72h-1Zm4.94,9.7c2.26,0,3.94-1.88,3.94-4.54s-1.76-4.48-4-4.48c-2.42,0-3.94,2-3.94,4.48C112.46,25.66,114.28,27.32,116.44,27.32Z" transform="translate(-4 -3)" style="fill:#fff"/><path d="M127.88,18.34c-2.46,0-3.2,2-3.2,4.18V28h-1V17.62h1v1.86a3.31,3.31,0,0,1,3.2-2.12Z" transform="translate(-4 -3)" style="fill:#fff"/><path d="M134.2,17.36a5.26,5.26,0,0,1,5.32,5.44,5.33,5.33,0,1,1-10.66,0A5.25,5.25,0,0,1,134.2,17.36Zm0,10a4.26,4.26,0,0,0,4.3-4.52,4.3,4.3,0,1,0-8.58,0A4.25,4.25,0,0,0,134.18,27.32Z" transform="translate(-4 -3)" style="fill:#fff"/><path d="M141.76,17.62h1v10.8c0,2.58-1.32,3.38-2.86,3.38l-.48,0v-.9l.44,0c1.24,0,1.9-.74,1.9-2.46Zm.5-3.58a.82.82,0,1,1-.82.82A.81.81,0,0,1,142.26,14Z" transform="translate(-4 -3)" style="fill:#fff"/><path d="M150,17.36c3,0,4.88,2.22,4.88,5.2V23h-8.84a4,4,0,0,0,4.24,4.36,4.15,4.15,0,0,0,3.58-1.78l.66.46a4.75,4.75,0,0,1-4.24,2.24A5.12,5.12,0,0,1,145,22.84C145,19.44,147.38,17.36,150,17.36Zm3.84,4.74A3.71,3.71,0,0,0,150,18.28a3.85,3.85,0,0,0-3.88,3.82Z" transform="translate(-4 -3)" style="fill:#fff"/><path d="M165,19.82a4.61,4.61,0,0,0-3.42-1.52,4.24,4.24,0,0,0-4.14,4.5,4.34,4.34,0,0,0,4.16,4.52,4.63,4.63,0,0,0,3.46-1.6l.36.88a5.08,5.08,0,0,1-3.84,1.66,5.23,5.23,0,0,1-5.2-5.46,5.25,5.25,0,0,1,5.2-5.44,5.17,5.17,0,0,1,3.82,1.58Z" transform="translate(-4 -3)" style="fill:#fff"/><path d="M167.66,15.46h1v2.16h2.44v.9h-2.44v5.84c0,2.26.52,2.84,2.08,2.84l.46,0v.9s-.48,0-.86,0c-1.64,0-2.68-1-2.68-3.12V18.52h-1.28v-.9h1.28Z" transform="translate(-4 -3)" style="fill:#fff"/></g></g></g></g></svg>
 </a>

          </div>
        <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
            <div class="justify-content-end">
                <ul class="navbar-nav mr-auto">
                    <ul class="navbar-nav mr-auto">
	<li class="nav-item nav-icon">
		<a  data-toggle="tooltip" data-toggle="tooltip" data-placement="bottom" title="check us out on GitHub" href="https://github.com/moby/moby#readme">
		<i class="fa fa-github" aria-hidden="true"></i></a>
	</li>
	<li>
		<a class="nav-item nav-icon"> 
		<a data-toggle="tooltip"  data-toggle="tooltip" data-placement="bottom" title="follow us on Twitter" href="https://twitter.com/moby"><i class="fa fa-twitter" aria-hidden="true"></i></a>
	</li>
	<li><a class="primary-nav-link nav-item" href="https://blog.mobyproject.org/">Blog</a></li>
	<li><a class="primary-nav-link nav-item" href="/community">Community</a></li>
	<li><a class="primary-nav-link nav-item" href="/projects">Projects</a></li>
	<li><a class="primary-nav-link" href="https://forums.mobyproject.org/" target="_blank">Forum</a></li>
</ul>

                </ul>
            </div>
        </div>
    <!-- </div> -->
</nav>

<div class="container">
  <div class="blog-content-post">
  <div class="post-meta">26 June 2017 by <a href="https://twitter.com/riyazdf">Riyaz Faizullabhoy</a></div>
	<h2 class="post-title">Sign all the things!</h2>
	   <h2 id="notary--linuxkit-deep-dive">Notary + LinuxKit deep dive</h2>

<p>Just a few months ago, we open sourced <a href="https://github.com/linuxkit/linuxkit">LinuxKit</a>, a toolkit to build secure, lean, and portable Linux subsystems. One of the key features of LinuxKit lies in its componentization: each of its individual components, including its kernel and system services, are completely swappable.<!--more--></p>

<p>As you can imagine, it is important to <em>trust</em> each and every one of these components so you can be sure your LinuxKit subsystem is assembled securely. In particular, you should be able to understand <em>where</em> the components come from, <em>what</em> they are supposed to include, and <em>when</em> you should stop using them in case they become out of date. This is a hard requirement for every package – after all, a system is only as secure as its most vulnerable component.</p>

<p>With this goal in mind, the LinuxKit team has been using <a href="https://github.com/docker/notary">Notary</a>, a signing and verification framework that is also part of the Moby Project, to make this easy. Today, every LinuxKit package is signed with Notary. We’d like to tell you more about what this means for your LinuxKit subsystems today, and what you can expect in the future.</p>

<h2 id="why-notary">Why Notary?</h2>

<p>Cryptographic signing is an absolute necessity for establishing trust over content sent over an untrusted media such as the internet. While there are many cryptographic signing systems available for use, most only provide integrity and authenticity guarantees - that the package contents were not modified, and that it was signed off by a key you trust.</p>

<p>Notary not only provides integrity and authenticity, but goes above and beyond by providing <em>survivable key compromise</em> and <em>freshness</em> properties.</p>

<p>By providing survivable key compromise, Notary ensures that any key can be seamlessly rotated out without breaking any trust or functionality in the system. This is particularly important if part of your signing process occurs in online, more exposed environments, where keys are more likely to be exfiltrated. Additionally, it’s difficult in many other signing frameworks to rotate the keys without discarding the root of trust or manually configuring subkeys.</p>

<p>Freshness ensures that you cannot download an old package, or get frozen in time on a stale package. This is a common issue in many signing systems: because it is difficult to invalidate or expire signatures, old and potentially vulnerable packages often carry still-valid signatures (ex: openssl with Heartbleed).</p>

<p>Notary achieves these guarantees by signing separate metadata to capture context about its packages. It’s worth mentioning that Notary and the signed metadata it produces is an implementation of <a href="https://theupdateframework.github.io/">The Update Framework</a>, which is a research project based from <a href="https://www.nyu.edu/">NYU</a> that has been published and discussed in several peer-reviewed academic publications.</p>

<h2 id="notary--linuxkit-better-together">Notary + LinuxKit: better together</h2>

<h3 id="perfect-for-our-packaging">Perfect for our packaging</h3>

<p>LinuxKit uses Docker images as the distribution format for all of its packages, including its kernel and init process, and the Docker Hub to store them. While Notary can sign over any type of content, Docker includes a robust and easy-to-use integration known as <a href="https://blog.docker.com/2015/08/content-trust-docker-1-8/">Docker Content Trust</a>. By simply exporting <code class="language-plaintext highlighter-rouge">DOCKER_CONTENT_TRUST=1</code>, Docker will verify all signatures on pull, and sign images on push.</p>

<p><img src="/images/trust_push.png" alt="Docker push with Content Trust" /></p>

<p>We also implemented a trust validation step in the <code class="language-plaintext highlighter-rouge">moby</code> build tool by leveraging the Notary library. Any packages that are specified by image or organization name in the LinuxKit yaml file will be verified using the Notary library. Today, all LinuxKit packages in the <code class="language-plaintext highlighter-rouge">linuxkit</code> organization in Docker Hub are signed:</p>

<p><img src="/images/trust_yml.png" alt="trust on moby build" /></p>

<h3 id="collaboration-made-easy">Collaboration made easy</h3>

<p>Each LinuxKit maintainer has their own key for signing purposes. These keys map to less-privileged roles in Notary known as delegations - not only does this prevent the need for sharing any private key material, but it also works seamlessly with Docker Content Trust, such that <code class="language-plaintext highlighter-rouge">DOCKER_CONTENT_TRUST=1 docker push linuxkit/kernel:4.9.x</code> pushes and signs with the appropriate keys. That said, the LinuxKit team went an extra step further to ensure that every Makefile for LinuxKit packages includes Docker Content Trust on every pull and push, so running <code class="language-plaintext highlighter-rouge">make</code> also works for convenience.</p>

<p><img src="/images/trust_roles.png" alt="delegation roles for LinuxKit maintainers" /></p>

<p>As we can see above, each maintainer has their own key and role, and there are a couple of extra roles for release management and CI. We can easily determine which role and key signed off on a package because that context is captured in Notary’s metadata, for example <a href="https://github.com/rn">Rolf</a> has signed off on several of the 4.10 series kernel packages:</p>

<p><img src="/images/trust_targets.png" alt="Notary signatures on linuxkit/kernel images" /></p>

<p>Using Notary delegations, we can not only audit who signed the packages, but enforce policy about the signatures on a package. For example: a package could require a simple threshold of two signatures, or even signoff from two maintainers and CI to be considered valid.</p>

<h2 id="a-trusted-package-manager">A trusted package manager</h2>

<p>Today, Notary and Docker Content Trust are deeply integrated into all LinuxKit packages, not only providing strong cryptographic and usability features, but ultimately equipping LinuxKit with a trusted package manager.</p>

<p>A great example of this integration is how the <code class="language-plaintext highlighter-rouge">moby</code> tool leverages Notary during offline builds for a LinuxKit image. If the <code class="language-plaintext highlighter-rouge">moby</code> tool detects it is offline when trying to update to the latest signed data for an individual package, it will fall back to already trusted data from a previous validation if the data is still unexpired. It will perform the same signature verification step using the key data it had previously trusted, and output a warning to the prompt to inform the user that there may be a more up to date version remotely for when they can get back online:</p>

<p><img src="/images/trust_caching.png" alt="handling offline signature verification" /></p>

<p>Overall, the LinuxKit team is excited to leverage Notary’s state-of-the-art signing and verification features, and we view it as a fundamental step to establish trust in our packages - to us, if a LinuxKit package isn’t signed by Notary, it should be as if <em>it doesn’t exist</em>.</p>

<p>Going forward, there are many features of Notary yet to explore: fine-grained auditing, signature threshold policy enforcement, and even key pinning to our roots of trust. We look forward to more advanced integrations between Notary and LinuxKit.</p>

  </div>
</div>

<footer class="footer">
    <div class="container">
        <div class="copyright">
            Copyright © 2023, Moby Project
        </div>
        <div class="footer-links">
            <ul class="navbar-nav mr-auto justify-content-end">
	<li class="nav-item nav-icon">
		<a  data-toggle="tooltip" data-toggle="tooltip" data-placement="top" title="check us out on GitHub" href="https://github.com/moby/moby#readme">
		<i class="fa fa-github" aria-hidden="true"></i></a>
	</li>

	<li>
		<a class="nav-item nav-icon"> 
		<a data-toggle="tooltip"  data-toggle="tooltip" data-placement="top" title="follow us on Twitter" href="https://twitter.com/moby"><i class="fa fa-twitter" aria-hidden="true"></i></a>
	</li>
	<li>
		<a class="nav-item nav-icon"> 
		<a data-toggle="tooltip" data-toggle="tooltip" data-placement="top" title="YouTube" href="https://www.youtube.com/playlist?list=PLkA60AVN3hh_eRYZIlUEYQFNN69iulTAk"><i class="fa fa-youtube" aria-hidden="true"></i></a>
	</li>
	<li>
		<a class="nav-item nav-icon"> 
		<a data-toggle="tooltip"  data-toggle="tooltip" data-placement="top" title="RSS Feed" href="https://blog.mobyproject.org/feed" target="_blank"><i class="fa fa-rss" aria-hidden="true"></i></a>
	</li>
	<li><a href="https://blog.mobyproject.org/">Blog</a></li>
	<li><a href="/community">Community</a></li>
	<li><a href="/projects">Projects</a></li>
</ul>

        </div>
    </div>
</footer>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/tether.min.js"></script>
<script src="/js/main.js"></script>
<script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    
    ga('create', 'UA-6096819-28', 'auto');
    ga('send', 'pageview');
</script>
</body>
</html>



